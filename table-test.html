<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Table Rendering Test</title>
    <link rel="stylesheet" href="./public/css/arzani-x.css">
    <!-- Required libraries -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.9/dist/purify.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/core.js"></script>
    
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        h2 {
            border-bottom: 1px solid #e5e7eb;
            padding-bottom: 8px;
        }
        .raw-markdown {
            background: #f9fafb;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 20px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 14px;
            overflow-x: auto;
            border: 1px solid #e5e7eb;
        }
        .output-container {
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 16px;
            background: white;
        }
        .controls {
            margin: 20px 0;
            display: flex;
            gap: 10px;
        }
        button {
            padding: 8px 16px;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background: #2563eb;
        }
    </style>
</head>
<body>
    <h1>Table Rendering Test</h1>
    
    <div class="controls">
        <button onclick="testMarkdownTable()">Test Table Rendering</button>
        <button onclick="testCustomRenderer()">Test Custom Renderer</button>
    </div>
    
    <div class="test-section">
        <h2>Raw Markdown</h2>
        <div class="raw-markdown" id="markdown-source">
# Business Valuation Analysis

## Valuation Summary & Methodology

| Method | Multiple Range | Your Business | Market Context |
|------------|-------------------|------------------|-------------------|
| EBITDA Multiple | 3.4x - 5.0x | 4.2x | Mixed market conditions |
| Revenue Multiple | 0.8x - 2x | N/A | Based on ecommerce sector |
| Asset Multiple | 0.8x - 1.5x | Subject to asset review | UK market standard |

Estimated Enterprise Value: £0
Valuation Range: £0 - £0

## Financial Profile Analysis

| Metric | Your Business | Industry Benchmark | Assessment |
|------------|------------------|----------------------|----------------|
| Annual Revenue | Not provided | Varies by size | Financial review required |
| EBITDA | £0 | 15% of revenue | Margin analysis needed |
| EBITDA Margin | N/A | 15% | Analysis required |
| Business Type | Ecommerce | UK ecommerce sector | Mixed conditions |
        </div>
    </div>
    
    <div class="test-section">
        <h2>Default Rendering</h2>
        <div class="output-container" id="default-output"></div>
    </div>
    
    <div class="test-section">
        <h2>Custom Table Rendering</h2>
        <div class="output-container" id="custom-output"></div>
    </div>
    
    <script>
        // Simple initialization for marked
        marked.setOptions({
            breaks: true,
            gfm: true
        });
        
        // Custom renderer for tables
        function createCustomRenderer() {
            const renderer = new marked.Renderer();
            
            renderer.table = function(header, body) {
                return `
                    <div class="arzani-table-wrapper overflow-x-auto my-6 rounded-lg border border-gray-200 shadow-sm">
                        <table class="arzani-table w-full table-auto min-w-full">
                            <thead class="arzani-table-head bg-gradient-to-r from-gray-50 to-gray-100">${header}</thead>
                            <tbody class="arzani-table-body bg-white divide-y divide-gray-100">${body}</tbody>
                        </table>
                    </div>`;
            };
            
            renderer.tablecell = function(content, flags) {
                const tag = flags.header ? 'th' : 'td';
                const align = flags.align ? ` style="text-align:${flags.align}"` : '';
                
                if (flags.header) {
                    return `<${tag}${align} class="arzani-th px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider border-b border-gray-200">${content}</${tag}>`;
                }
                
                return `<${tag}${align} class="arzani-td px-4 py-3 text-sm text-gray-900">${content}</${tag}>`;
            };
            
            return renderer;
        }
        
        // Function to test default markdown rendering
        function testMarkdownTable() {
            const markdown = document.getElementById('markdown-source').textContent;
            const defaultOutput = document.getElementById('default-output');
            
            // Default rendering
            defaultOutput.innerHTML = DOMPurify.sanitize(marked.parse(markdown));
            
            // Add custom styles manually for comparison
            const style = document.createElement('style');
            style.textContent = `
                .arzani-table-wrapper {
                    width: 100% !important;
                    overflow-x: auto !important;
                    margin: 1.5rem 0 !important;
                    border-radius: 0.5rem !important;
                    box-shadow: 0 1px 3px rgba(0,0,0,0.1) !important;
                }
                
                .arzani-table {
                    width: 100% !important;
                    border-collapse: collapse !important;
                    border: 1px solid #e5e7eb !important;
                    font-size: 14px !important;
                    table-layout: auto !important;
                }
                
                .arzani-table-head {
                    background-color: #f9fafb !important;
                }
                
                .arzani-th {
                    padding: 0.75rem 1rem !important;
                    text-align: left !important;
                    font-weight: 600 !important;
                    color: #374151 !important;
                    border-bottom: 1px solid #e5e7eb !important;
                    text-transform: uppercase !important;
                    letter-spacing: 0.05em !important;
                    font-size: 0.75rem !important;
                    vertical-align: middle !important;
                }
                
                .arzani-td {
                    padding: 0.75rem 1rem !important;
                    border-bottom: 1px solid #e5e7eb !important;
                    color: #1f2937 !important;
                    vertical-align: top !important;
                }
                
                .arzani-table-body tr:nth-child(even) {
                    background-color: #f9fafb !important;
                }
                
                .arzani-table-body tr:hover {
                    background-color: #f3f4f6 !important;
                }
            `;
            document.head.appendChild(style);
        }
        
        // Function to test custom renderer
        function testCustomRenderer() {
            const markdown = document.getElementById('markdown-source').textContent;
            const customOutput = document.getElementById('custom-output');
            
            // Use custom renderer
            const customRenderer = createCustomRenderer();
            marked.use({ renderer: customRenderer });
            
            customOutput.innerHTML = DOMPurify.sanitize(marked.parse(markdown));
            
            // Reset renderer
            marked.use({ renderer: new marked.Renderer() });
        }
        
        // Run tests when page loads
        window.onload = function() {
            testMarkdownTable();
            testCustomRenderer();
        };
    </script>
</body>
</html>
